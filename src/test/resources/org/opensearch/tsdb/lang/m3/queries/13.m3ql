log_difference = fetch service:logger name:logs
  | sum
  | diff (
    fetch service:logger name:attempts
      | sum
  )
  | abs;

not_error_backoff_proportion = fetch service:logger error_type:!backoff
  | sum
  | divideSeries (
    fetch service:logger error_type:*
      | sum
  )
  | abs
  | transformNull 0
  | moving 5m avg;

scaled_diff = log_difference
  | (not_error_backoff_proportion) # test group around macro, group applies to expanded macro
  | multiplySeries;

scaled_diff
  | asPercent (
    fetch service:logger name:attempts
      | sum
  )
  | moving 5m min
  | alias percent
